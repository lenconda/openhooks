#!/usr/bin/env node

var program = require('commander');
var OhServer = require('../modules/server');
var ohAdd = require('../modules/add');
var ohLs = require('../modules/ls');
var ohDel = require('../modules/del');

program
  .version('0.0.2');

program
  .command('server <action> [port]')
  .description('manage webhook server')
  .action(function (action, port) {
    var ohServer = new OhServer(port || '5000');
    switch (action) {
      case 'start':
        ohServer.start();
        break;
      case 'stop':
        ohServer.stop();
        break;
      case 'restart':
        ohServer.restart();
        break;
      default:
        console.log('Param error...');
    }
  })

program
  .command('add')
  .description('add a webhook')
  .option('-d --desc <description>', 'add description for the webhook')
  .option('-c --command <cmd>', 'add command when the webhook is triggered')
  .action(function (options) {
    var id = ohAdd(options.desc, options.command);
    console.log('Added a new path: /hooks/' + id);
  });

program
  .command('ls')
  .description('list all webhooks of the server')
  .action(function () {
    var results = ohLs();
    console.log('Total: ' + results.length);
    console.table(results);
  });

program
  .command('del <index>')
  .description('delete a webhook with specified index')
  .action(function (index) {
    ohDel.del(index);
  });

program
  .command('clear')
  .description('clear all webhooks')
  .action(function () {
    ohDel.clear();
  })

program.parse(process.argv);
